<!DOCTYPE html>
<html>

<meta charset="utf-8">

<head>
<title>Nigeria Map</title>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<style>
</style>
</head>

<body>
<div id="main">
	<div id="mapContainer"></div>
	<div id="lineChartContainer"></div>
</div>
</body>

<script>
/*Declaring Constants*/
var mapContainerSize = {'height':800,'width':800};
var mapSize = {'height':800,'width':800};

/*Creating the canvas*/
var mapContainer = d3.select('#mapContainer').append('svg')
					.attr({
						width: mapContainerSize.width,
						height: mapContainerSize.height
					});

var map = mapContainer.append('g')
					.attr({
						width: mapSize.width,
						height: mapSize.height
					});

/*Defining mapping variables*/
var projection = d3.geo.mercator()
					.center([0,0])
					.scale(1500)
					.translate([mapSize.width/2, mapSize.height/2]);

var path = d3.geo.path()
			.projection(projection);


var color = d3.scale.threshold()
			.range(['rgb(189,0,38)','rgb(240,59,32)','rgb(253,141,60)','rgb(254,178,76)','rgb(254,217,118)']);



/* Loading data for the map */
d3.csv("/data/dataSum.csv", function(data){
	//setting the color domain based on the data
	color.domain([
		d3.min(data, function(d) { return d.price; }),
		d3.max(data, function(d) { return d.price; })])

	//loading map data
	d3.json("/maps/nga-states-topo-05.json", function(error, nigeriaStates){
		//creating a variable to call features collection
		var stateFeatures = topojson.feature(nigeriaStates, nigeriaStates.objects.NGA_adm1).features
		//merging the two datasets
		for(var i = 0; i < data.length; i++){
			//pulling the states from csv file
			var dataState = data[i].state;
			//pulling corresponding price values and converting to number from string
			var dataValue = parseFloat(data[i].price)

			//adding the price value to the map properties
			for(var j = 0; j < stateFeatures.length; j++){
				var jsonState = stateFeatures[j].properties.state_name;
				if(dataState == jsonState){
					stateFeatures[j].properties.price = dataValue
					break;
				}
			}
		}
		console.log(stateFeatures[1].properties)
		map.selectAll('.states')
			.data(stateFeatures)
			.enter()
			.append('path')
			.attr({
				d: path,
				'class': 'states'
			})
			.style('fill', function(d, i){
				var value = d.properties.price;
				if(value) {
					return color(value);
				} else {
					 return "#ccc";
				}
			});
	})
})

/*
var dataLookup = d3.csv("/data/dataSum.csv")
	.row(function(d) { return {key: d.state, value: +d.price}})
	//.get(function(error, rows) { console.log(rows); })

console.log(dataLookup[d.key])
*/

/*Inputing Data and drawing the map on the canvas using the defined path variable*/



/*var mapper = d3.map()


d3.csv("/data/dataSum.csv", function(d){
	mapper.set(d.state, +d.price)
	console.log(d)

	dataset = dataSum.map(function(d){return +d["state"], +d["price"]})
	console.log(dataset)
	dataSum.forEach(function(d){
		console.log(d['state'])
	})
	data.forEach(function(d){
		d.state =
	})
})
*/

/* Filling the map with the  color */





</script>
</html>
